import { Comment } from '../../../shared/src/types/comment.types';

export class CommentService {
  generateCommentsBefore(movieTitle: string, upToTimestamp: number, count: number): Comment[] {
    const comments = [];
    // Генерируем комментарии для моментов до указанного времени
    for (let i = 0; i < count; i++) {
      const timestamp = Math.floor(Math.random() * upToTimestamp);
      comments.push({
        id: `${Date.now()}_${i}`,
        movieId: '',
        movieTitle,
        timestamp,
        text: this.generateFact(movieTitle, timestamp),
        createdAt: new Date()
      });
    }
    return comments.sort((a, b) => a.timestamp - b.timestamp);
  }

  private generateFact(movieTitle: string, timestamp: number): string {
    const minutes = Math.floor(timestamp / 60);
    const seconds = timestamp % 60;
    const timeStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    const facts = [
      `На ${timeStr} происходит важная сцена, которая многое объясняет!`,
      `Обрати внимание на диалог в ${timeStr} - там есть скрытый смысл.`,
      `Актер в этой сцене (${timeStr}) improviziroval - этого не было в сценарии!`,
      `Саундтрек в ${timeStr} написан специально для этого момента.`,
      `Режиссер считает сцену на ${timeStr} одной из лучших в фильме.`,
      `На ${timeStr} можно заметить интересную деталь в кадре.`,
      `Этот момент (${timeStr}) особенно любят фанаты.`,
      `Съемки этой сцены (${timeStr}) проходили в необычном месте.`,
      "В этой сцене актёр действительно поранился, но продолжил играть",
      "Режиссёр снял этот дубль с первого раза, что большая редкость",
      "Эта фраза стала мемом после выхода фильма",
      "Сцена снималась в реальных условиях без спецэффектов",
      "Актёр сам выполнял этот трюк без дублёра",
      "Изначально эту роль должен был играть другой актёр",
      "Бюджет сцены превысил ожидания в два раза",
      "В кадре можно заметить небольшую ошибку монтажа",
      "Саундтрек к этому моменту писался специально под сцену",
      "Этот кадр снимали три дня подряд",
      "Актёр improvisiroval - этой фразы не было в сценарии",
      "В массовке снимались настоящие фанаты фильма",
      "Спецэффекты для этой сцены делала известная студия",
      "Режиссер считает этот момент ключевым в фильме",
      "На съемках этой сцены произошел забавный случай",
      "Костюм актёра весил более 20 килограммов",
      "Эта сцена была полностью переписана в последний момент",
      "В фильме есть скрытая отсылка к другому известному кино",
      "Актёры подружились на съемках и дружат до сих пор",
      "Для этой сцены построили специальные декорации",
      "Оператор использовал уникальную технику съемки",
      "В этом моменте спрятана пасхалка для внимательных зрителей",
      "Сцена вызвала споры среди критиков после выхода",
      "Актёр специально худел/набирал вес для этой роли",
      "В фильме использованы реальные исторические костюмы",
      "Эту сцену вырезали в некоторых странах из-за цензуры",
      "На заднем плане можно заметить друга режиссёра в камео",
      "Диалог был придуман прямо на съемочной площадке",
      "Съемочная группа работала круглосуточно над этим эпизодом",
      "В этой сцене использована революционная технология",
      "Актёр учился новому навыку специально для роли",
      "Музыка в этом моменте стала визитной карточкой фильма",
      "Сцена снималась в девяти разных локациях",
      "Режиссер сделал 30 дублей, добиваясь идеала",
      "В титрах поблагодарили местных жителей за помощь",
      "Этот эпизод добавили уже после тестовых показов",
      "Актриса сама исполняла все вокальные партии",
      "Грим занимал по 4 часа каждый съемочный день",
      "Сценарий этого момента переписывали 7 раз",
      "В фильме использованы настоящие музейные экспонаты",
      "Каскадер получил травму, но закончил съемку",
      "Эта сцена пародирует известное полотно живописи",
      "Звук записывали отдельно и накладывали в студии",
      "Актёры не видели друг друга до съемок этой сцены",
      "Реквизит для сцены искали по всей стране",
      "В этом моменте слышна настоящая запись из архива",
      "Сцену хотели вырезать, но оставили после тестов",
      "Освещение создавали по картинам известных художников",
      "Актёр написал часть диалогов для своего персонажа",
      "Эта сцена стала самой дорогой в фильме"
    ];
    
let factHistory = [];
function getRandomFact() {
  // Если история заполнена (5 фактов), удаляем самый старый
  if (factHistory.length >= 10) {
    factHistory.shift();
  }
  // Фильтруем факты, исключая те, что уже были в истории
  const availableFacts = facts.filter(fact => !factHistory.includes(fact));
  // Выбираем случайный факт из доступных
  const randomIndex = Math.floor(Math.random() * availableFacts.length);
  const selectedFact = availableFacts[randomIndex];
  // Добавляем выбранный факт в историю
  factHistory.push(selectedFact);
  return selectedFact;
}
// Использование:
const fact = getRandomFact();
console.log(fact);

    return fact
    //facts[Math.floor(Math.random() * facts.length)]; //
  }}
   